D1 = 2*emc;
D2 = 2*emg;
D3 = 2*emt;
D8 = 3*emt;
Da = (2-1/3)*emt;
D= [emt; 2*emc; 2*emg];
Dtil= [Da; emc; emg]./D;
r28=-ut-lt;
r30=-2*lt;
r31=At'*r28-At'*(r30/3);
rp=[zeros(mt,1);emc;ug];
rptil=A'*(rp.*Dtil)-r31;
[L,p]=chol(sparse(A'*sparse(diag(Dtil))*A)+speye(n));
L=sparse(L);
x=L\(L'\rptil);
d=(A*x-rp)./D;
a=d(1:mt);
c=d(mt+1:mt+mc);
g=d(mt+mc+1:mt+mc+mg);
t=-(r30+a)/3;
su=ut-a;
sl=-lt+a+t;
sc=-c-emc;
sg=-g-emg;
st=lt-t;

r29=Ac'*emc+Ag'*emg;
r31=r29-(w/3)*(At'*emt);
rp=[zeros(mt,1);emc;emg];
rptil=A'*(rp.*Dtil)-r31;
zx=-(L\(L'\rptil));
d=(A*zx+rp)./D;
yu=-d(1:mt);
wc=d(mt+1:mt+mc);
wg=d(mt+mc+1:mt+mc+mg);
yt=-yu./D8;
ya=-D3.*yu-yt;
yl=-yu-yt;
yc=emc-wc;
yg=emg-wg;
zt=-yt;

na= norm(A,1);
ep1= sum(ut) + 2*sum(lt) + sum(ug);
ep4= ep1/100/na;
ep1= max(ep1,ep4);
ep3= min([x; c; g; t; su; sl; sc; sg; st;]);
ep1= max(ep1,-ep3);
ep1= max(ep1,100000);
a= max(a,ep1);
a= zeros(mt,1);
x= max(x,ep1);
c= max(c,ep1);
g= max(g,ep1);
t= max(t,ep1);
su= max(su,ep1);
sl= max(sl,ep1);
sc= max(sc,ep1);
sg= max(sg,ep1);
st= max(st,ep1);

ep2= w*mt + mc + mg;
ep5= ep2/100/na;
ep2= max(ep2,ep5);
ep3= min([zx; yc; yg; yt; yu; yl; wc; wg; zt;]);
ep2= max(ep2,-ep3);
ep2= max(ep2,100000);
ya= max(ya,ep2);
ya= zeros(mt,1);
zx= max(zx,ep2);
yc= max(yc,ep2);
yg= max(yg,ep2);
yt= max(yt,ep2);
yu= max(yu,ep2);
yl= max(yl,ep2);
wc= max(wc,ep2);
wg= max(wg,ep2);
zt= max(zt,ep2);

